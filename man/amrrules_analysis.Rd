% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/analysis_functions.R
\name{amrrules_analysis}
\alias{amrrules_analysis}
\title{AMR Genotype-Phenotype Analysis to support defining AMRrules}
\usage{
amrrules_analysis(
  geno_table,
  pheno_table,
  antibiotic,
  drug_class_list,
  species,
  sir_col = "pheno_eucast",
  ecoff_col = "ecoff",
  sir_provided_col = "pheno_provided",
  geno_sample_col = "Name",
  pheno_sample_col = "id",
  marker_col = "marker.label",
  minPPV = 1,
  mafLogReg = 5,
  mafUpset = 1,
  info = NULL
)
}
\arguments{
\item{geno_table}{A data frame of genotypic data with a \code{drug_class} column, sample IDs (specified using \code{geno_sample_col}), and AMR determinants (\code{marker}). Can be generated from AMRfinderplus output using \code{AMRgen::import_amrfp}.}

\item{pheno_table}{A data frame of phenotypic data, including columns for sample IDs (specified using \code{pheno_sample_col}), antibiotic (\code{drug_agent}), MIC (\code{mic}), disk diffusion (\code{disk}), and S/I/R classification (specified using \code{sir_col}).}

\item{antibiotic}{A string specifying the antibiotic to analyze (e.g., \code{"Ciprofloxacin"}).}

\item{drug_class_list}{A character vector of drug classes whose attributed markers should be included in the analysis.}

\item{species}{A string indicating the species name used for breakpoint and reference distribution lookups (e.g., \code{"E. coli"}).}

\item{sir_col}{The name of the trusted S/I/R classification column to use, e.g. inferred from available MIC and/or disk data (default: \code{"pheno_eucast"}).}

\item{ecoff_col}{The name of the column providing S/R calls indicating the classification of each sample and drug against the ECOFF (default: \code{"ecoff"}).}

\item{sir_provided_col}{The name of the extended S/I/R classification column, e.g. including calls provided as S/I/R but without assay measures to interpret directly (default: \code{"pheno_provided"}).}

\item{geno_sample_col}{The column in \code{geno_table} with sample IDs (default: \code{"Name"}).}

\item{pheno_sample_col}{The column in \code{pheno_table} with sample IDs (default: \code{"id"}).}

\item{marker_col}{A character string specifying the column name in \code{geno_table} containing the marker identifiers. Defaults to \code{"marker.label"}.}

\item{minPPV}{Minimum number of samples required for a marker to be included in PPV analysis (default: 1).}

\item{mafLogReg}{Minor allele frequency threshold for logistic regression inclusion (default: 5).}

\item{mafUpset}{Minor allele frequency threshold for upset plot inclusion (default: 1).}

\item{info}{Data frame indicating information about each sample, so we can summarise the source/s of data supporting each rule. First column should be sample id, matching that in the \code{pheno_table} object.}
}
\value{
A list containing:
\item{reference_mic_plot}{EUCAST reference MIC distribution plot}
\item{reference_disk_plot}{EUCAST reference disk zone distribution plot}
\item{summary}{Output of \code{\link{summarise_data}} showing sample and breakpoint summaries}
\item{solo_stats}{PPV statistics for individual markers}
\item{solo_binary}{Binary matrix of individual marker presence by sample}
\item{amr_binary}{Binary matrix of AMR marker presence by sample}
\item{ppv_plot}{Bar plot summarizing PPV results}
\item{logistic_mat}{Binary matrix used in logistic regression}
\item{logistic_plot}{Plot of logistic regression estimates}
\item{ppv_logistic_plot}{Combined PPV/logistic plot}
\item{modelR}{Logistic model for predicting resistance}
\item{modelNWT}{Logistic model for predicting NWT (non-wild-type)}
\item{allstatsR}{Merged statistics for R category}
\item{allstatsNWT}{Merged statistics for NWT category}
\item{upset_mic_plot}{Upset plot for MIC data}
\item{upset_disk_plot}{Upset plot for disk data}
\item{upset_mic_summary}{MIC data summarised per marker or combination}
\item{upset_disk_summary}{Disk diffusion data summarised per marker or combination}
\item{combination_summary_values}{Summary of genotype combinations from both MIC and disk}
\item{afp_hits}{List of AMR markers detected}
\item{species}{The species used in the analysis}
\item{antibiotic}{The antibiotic used in the analysis}
}
\description{
This function runs a full AMR rule analysis pipeline, using the AMR and AMRgen packages, for a specified antibiotic and organism.
It includes EUCAST reference distribution plotting, phenotype/genotype overlap, solo PPV calculations, logistic regression,
upset plots for disk and MIC data, and summary statistics for AMR markers.
}
\details{
It outputs data and plots used to assess AMR marker relevance, which can be used as input to the \code{makerules} function.

This function is designed to assist in AMR rule derivation by integrating multiple evidence streams: EUCAST distributions,
solo PPV calculations, logistic regression models, and marker co-occurrence patterns.

All steps are wrapped in \code{safe_execute()} to allow the pipeline to run partially in case of errors.
}
\examples{
\dontrun{
amrrules_analysis(geno_table, pheno_table, antibiotic = "Ciprofloxacin",
                  drug_class_list = c("Quinolones"), species = "E. coli")
}

}
